<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-with, initial-scale=1, shrink-to-fit=no">
  <meta http-equiv="content-type" content="text/html; charset = UTF-8">
  <link type="text/css" rel="stylesheet" href="/plugin/css/bootstrap.min.css" />
  <link type="text/css" rel="stylesheet" href="/plugin/css/bootstrap-vue.min.css" />
  <style>
    #app {
      margin-top: 20px;
    }
  </style>
  <script src="/plugin/js/vue.min.js"></script>
  <script src="/plugin/js/vue-i18n.min.js"></script>
  <script src="/plugin/js/axios.min.js"></script>
  <script src="/plugin/js/bootstrap-vue.min.js"></script>
  <script src="/plugin/js/md5.min.js"></script>
  <script src="/plugin/js/common.js"></script>
  <title>人・物レコード表示テスト</title>
</head>
<body>
  <div id="app">
    <b-breadcrumb :items="breadcrumbItems"></b-breadcrumb>
    <b-container fluid>
      <b-row>
        <b-table :items="items" :fields="fields" striped hover>
          <template slot="thumbnail" slot-scope="row">
            <img v-if="row.item.existThumbnail" :src="thumbnail(row.item)" height="70">
          </template>
        </b-table>
      </b-row>
    </b-container>
  </div>
  <script>
    (async () => {
      const common = new Common()
      const i18n = await common.getI18n()
      const app = new Vue({
        el: '#app',
        data() {
          return {
            fields: [
              {
                key: 'potId',
                label: i18n.t("label.potId"),
              },
              {
                key: 'thumbnail',
                label: i18n.t("label.thumbnail"),
              },
              {
                key: 'name',
                label: i18n.t("label.potName"),
              },
              {
                key: 'group',
                label: i18n.t("label.group"),
              },
              {
                key: 'category',
                label: i18n.t("label.category"),
              }
            ],
            items: [],
            breadcrumbItems: [
              {
                text: i18n.t("label.breadcrumbTitle1"),
                href: '#'
              },
              {
                text: i18n.t("label.breadcrumbTitle2"),
                href: 'active'
              }
            ],
            urlBase: null
          }
        },
        async mounted() {
          this.urlBase = window.localStorage.getItem('api-base-url')
          const config = {
            headers: {
              apiKey: common.getApiKey()
            }
          }
          const pots = await common.apServiceClient.get(this.urlBase + '/basic/pot', config)
          this.items = pots.data.map((pot) => {
            return {potId: pot.potId, name: pot.potName, group: pot.groupName, category: pot.categoryName, existThumbnail: pot.existThumbnail}
          })
        },
        methods: {
          thumbnail(row) {
            return this.urlBase + '/basic/pot/potThumbnail/' + row.potId
          }
        },
      })
    })()
  </script>
</body>
</html>